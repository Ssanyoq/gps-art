<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Gps art - map creating</title>
  <script type=text/javascript src="{{
  url_for('static', filename='jquery.js') }}"></script>
  <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
  <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='styles/map_page.css') }}">
</head>

<body>

  <div id="demo"></div>
  <div id="demo1"></div>
  <img src={{img}} id="map" alt="Карты не нашлось :(">


  <script>
    let mouse_x = null, mouse_y = null;
    (function () {
      document.onmousemove = handleMouseMove;
      function handleMouseMove(event) {
        var eventDoc, doc, body;

        event = event || window.event;

        if (event.pageX == null && event.clientX != null) {
          eventDoc = (event.target && event.target.ownerDocument) || document;
          doc = eventDoc.documentElement;
          body = eventDoc.body;

          event.pageX = event.clientX +
            (doc && doc.scrollLeft || body && body.scrollLeft || 0) -
            (doc && doc.clientLeft || body && body.clientLeft || 0);
          event.pageY = event.clientY +
            (doc && doc.scrollTop || body && body.scrollTop || 0) -
            (doc && doc.clientTop || body && body.clientTop || 0);
        }

        // Use event.pageX / event.pageY here
        mouse_x = event.pageX;
        mouse_y = event.pageY;

      }
    })();
    $("#map").click(function () {
      document.getElementById("demo").innerHTML = mouse_x;
      document.getElementById("demo1").innerHTML = mouse_y;
      $.ajax({
        type: 'POST',
        url: "/_map",
        data: { mouse_x: mouse_x, mouse_y: mouse_y },
        dataType: "text",
        success: function (img_path) {
          document.getElementById("map").src = img_path;
        }
      });
    });


  </script>
</body>

</html>